scenario: "Validate: Fields on correct type"
background:
  schema-file: validation.schema.graphql
tests:
  - name: no operations
    given:
      query: |-
        fragment fragA on Type {
          field
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      passes: true
  - name: one anon operation
    given:
      query: |-
        {
          field
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      passes: true
  - name: one named operation
    given:
      query: |-
        query Foo {
          field
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      passes: true
  - name: multiple operations
    given:
      query: |-
        query Foo {
          field
        }
        query Bar {
          field
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      passes: true
  - name: multiple operations of different type
    given:
      query: |-
        query Foo {
          field
        }
        mutation Bar {
          field
        }
        subscription Baz {
          field
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      passes: true
  - name: fragment and operation named the same
    given:
      query: |-
        query Foo {
          ...Foo
        }
        fragment Foo on Type {
          field
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      passes: true
  - name: multiple operations of same name
    given:
      query: |-
        query Foo {
          fieldA
        }
        query Foo {
          fieldB
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      - error-count: 1
      - error-code: undefinedField
        args:
          fieldName: name
          type: CatOrDog
        loc:
          line: 2
          column: 3
  - name: multiple ops of same name of different types (mutation)
    given:
      query: |-
        query Foo {
          fieldA
        }
        mutation Foo {
          fieldB
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      - error-count: 1
      - error-code: undefinedField
        args:
          fieldName: name
          type: CatOrDog
        loc:
          line: 2
          column: 3
  - name: multiple ops of same name of different types (subscription)
    given:
      query: |-
        query Foo {
          fieldA
        }
        subscription Foo {
          fieldB
        }
    when:
      validate:
        - FieldsOnCorrectType
    then:
      - error-count: 1
      - error-code: undefinedField
        args:
          fieldName: name
          type: CatOrDog
        loc:
          line: 2
          column: 3
